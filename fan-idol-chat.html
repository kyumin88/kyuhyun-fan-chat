<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>åœ­è´¤ç²‰ä¸äº’åŠ¨å¹³å°</title>
    <link href="https://cdn.tailwindcss.com/3.4.1" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #007AFF; /* å¾®ä¿¡é£æ ¼å®è“è‰² */
            --secondary-color: #5AC8FA;
            --wechat-bg: #EDEDED;
        }
        body {
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }
        .message-bubble {
            max-width: 70%;
            padding: 8px 12px;
            margin-bottom: 12px;
            position: relative;
            word-break: break-word;
            font-size: 16px;
            line-height: 1.4;
        }
        .fan-message {
            background-color: white;
            border-radius: 4px 18px 18px 4px;
            align-self: flex-start;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
            margin-right: 30%;
        }
        .idol-message {
            background-color: var(--primary-color);
            color: white;
            border-radius: 18px 4px 4px 18px;
            align-self: flex-end;
            margin-left: 30%;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .status-bar {
            height: env(safe-area-inset-top);
            background-color: var(--primary-color);
        }
    </style>
</head>
<body class="bg-[#EDEDED] min-h-screen" style="background-color: var(--wechat-bg)">
    <div class="status-bar"></div>
    <div class="container mx-auto p-0 max-w-full flex flex-col h-screen">
        <header class="bg-white p-4 border-b border-gray-200 sticky top-0 z-10">
            <div class="flex items-center justify-between">
                <button class="text-gray-600">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <h1 class="text-lg font-semibold text-center text-blue-600">
                    <i class="fas fa-star mr-2 text-yellow-400"></i>åœ­è´¤å°åŠ©æ‰‹
                </h1>
                <button class="text-gray-600">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </header>
        
        <div id="chat-container" class="flex-1 overflow-y-auto p-3" style="background-color: var(--wechat-bg)">
            <!-- èŠå¤©æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <div class="text-center text-xs text-gray-400 my-4">
                ä»Šå¤© 14:30
            </div>
        </div>
        
        <div class="bg-white border-t border-gray-200 p-3 sticky bottom-0">
            <div class="flex items-center space-x-2">
                <button class="text-gray-500 p-2">
                    <i class="fas fa-plus"></i>
                </button>
                <input type="text" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." 
                    class="flex-1 border rounded-full px-4 py-2 focus:outline-none bg-gray-100">
                <button id="record-voice" class="text-gray-500 p-2">
                    <i class="fas fa-microphone"></i>
                </button>
                <button id="send-text" class="bg-red-500 text-white p-2 rounded-full w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="flex justify-around pt-2 text-xs text-gray-500">
                <div class="text-center">
                    <i class="fas fa-home block text-lg"></i>
                    <span>é¦–é¡µ</span>
                </div>
                <div class="text-center">
                    <i class="fas fa-comment block text-lg"></i>
                    <span>æ¶ˆæ¯</span>
                </div>
                <div class="text-center">
                    <i class="fas fa-user block text-lg"></i>
                    <span>æˆ‘çš„</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŸºç¡€äº¤äº’é€»è¾‘å°†åœ¨è¿™é‡Œå®ç°
        document.getElementById('send-text').addEventListener('click', sendTextMessage);
        document.getElementById('record-voice').addEventListener('mousedown', startRecording);
        document.getElementById('record-voice').addEventListener('mouseup', stopRecording);
        
        let recognition;
        let isRecording = false;
        
        function sendTextMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (message) {
                // æ·»åŠ å‘é€åŠ¨ç”»
                const sendBtn = document.getElementById('send-text');
                sendBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
                
                addMessage(message, 'fan');
                input.value = '';
                
                // æ¢å¤å‘é€æŒ‰é’®
                setTimeout(() => {
                    sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
                }, 500);
                
                // æ¨¡æ‹Ÿçˆ±è±†å›å¤
                setTimeout(() => {
                    const responses = {
                        idol: [
                            "è°¢è°¢E.L.Fçš„æ”¯æŒï¼ğŸ’™",
                            "æˆ‘ä»¬Super Juniorä¼šä¸€ç›´èµ°èŠ±è·¯çš„ï¼",
                            "åœ­è´¤çˆ±ä½ å“Ÿ~",
                            "ä¸‹æ¬¡æ¼”å”±ä¼šè§å§ï¼",
                            "ä¿æŒå¥åº·ï¼Œæˆ‘ä»¬å¾ˆå¿«ä¼šè§é¢çš„ï¼",
                            "è®°å¾—å¬æˆ‘çš„æ–°æ­Œ<åœ¨å…‰åŒ–é—¨>å“¦ï¼",
                            "Sapphire blue foreverï¼"
                        ],
                        daily: [
                            "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå–æ¯å’–å•¡å‘¢~",
                            "æˆ‘åˆšç»ƒå®Œæ­Œï¼Œå—“å­æœ‰ç‚¹ç´¯ä½†å¾ˆå¼€å¿ƒï¼",
                            "ä½ æœ€è¿‘åœ¨çœ‹ä»€ä¹ˆç”µè§†å‰§ï¼Ÿæ¨èç»™æˆ‘å§",
                            "æˆ‘æœ€è¿‘åœ¨å­¦åšèœï¼Œæœ€æ‹¿æ‰‹çš„æ˜¯æ³¡èœæ±¤",
                            "å‘¨æœ«å–œæ¬¢å’Œæœ‹å‹å»æ‰“ä¿é¾„çƒï¼Œä½ è¦ä¸€èµ·å—ï¼Ÿ",
                            "ç¡å‰éƒ½ä¼šçœ‹ä¼šå„¿ä¹¦ï¼Œä½ å–œæ¬¢ä»€ä¹ˆç±»å‹çš„ä¹¦ï¼Ÿ",
                            "æœ€è¿‘åœ¨é‡æ¸©ã€Šè¯·å›ç­”1988ã€‹ï¼ŒçœŸæ˜¯ç™¾çœ‹ä¸åŒå‘¢",
                            "ä½ å–œæ¬¢ç‹—å—ï¼Ÿæˆ‘å…»äº†ä¸€åªå¯çˆ±çš„é©¬å°”æµæ–¯çŠ¬"
                        ],
                        food: [
                            "æ¨èä½ è¯•è¯•æˆ‘ä»¬éŸ©å›½çš„å¤§é…±æ±¤ï¼Œå¾ˆç¾å‘³å“¦ï¼",
                            "æœ€è¿‘è¿·ä¸Šäº†ä¸­é¤çš„ç«é”…ï¼Œè¾£å¾—å¾ˆè¿‡ç˜¾",
                            "ä½œä¸ºä¸»å”±è¦ä¿æŠ¤å—“å­ï¼Œæ‰€ä»¥å¾ˆå°‘åƒå¤ªå†°çš„é£Ÿç‰©",
                            "æœ€çˆ±çš„é›¶é£Ÿæ˜¯èœ‚èœœé»„æ²¹è–¯ç‰‡ï¼Œæ ¹æœ¬åœä¸ä¸‹æ¥",
                            "éŸ©å›½å†·é¢å¤å¤©åƒæœ€çˆ½å£äº†ï¼Œæ¨èä½ è¯•è¯•"
                        ],
                        music: [
                            "æœ€è¿‘åœ¨å‡†å¤‡æ–°ä¸“è¾‘ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥æƒŠå–œ",
                            "ç»ƒä¹ ç”Ÿæ—¶æœŸæ¯å¤©è¦ç»ƒæ­Œ8å°æ—¶ä»¥ä¸Šå‘¢",
                            "éŸ³ä¹æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†",
                            "åœ¨èˆå°ä¸Šå”±æ­Œæ˜¯æœ€å¹¸ç¦çš„äº‹æƒ…"
                        ]
                    };

                    // æ ¹æ®ç”¨æˆ·æ¶ˆæ¯ç±»å‹é€‰æ‹©å›å¤ç±»åˆ«
                    let category = 'idol';
                    if (message.includes('å¤©æ°”') || message.includes('ä»Šå¤©') || message.includes('æœ€è¿‘')) {
                        category = 'daily';
                    } else if (message.includes('åƒ') || message.includes('ç¾é£Ÿ') || message.includes('å–')) {
                        category = 'food';
                    } else if (message.includes('æ­Œ') || message.includes('éŸ³ä¹') || message.includes('å”±')) {
                        category = 'music';
                    }
                    
                    const responseList = responses[category];
                    const response = responseList[Math.floor(Math.random() * responseList.length)];
                    addMessage(response, 'idol');
                    speak(response); // è¯­éŸ³åˆæˆå›å¤
                }, 1000);
            }
        }
        
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message-bubble', `${sender}-message`);
            messageDiv.textContent = text;
            
            // æ·»åŠ æ—¶é—´æˆ³
            const timeDiv = document.createElement('div');
            const now = new Date();
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            timeDiv.textContent = timeString;
            timeDiv.classList.add('text-xs', 'mt-1', 'text-right', 'opacity-70');
            if(sender === 'fan') {
                timeDiv.classList.add('text-gray-500');
            } else {
                timeDiv.classList.add('text-white');
            }
            
            messageDiv.appendChild(timeDiv);
            chatContainer.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 50);
        }
        
        // è¯­éŸ³è¯†åˆ«åŠŸèƒ½
        function startRecording() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½');
                return;
            }
            
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.interimResults = false;
            
            recognition.onstart = function() {
                isRecording = true;
                const voiceBtn = document.getElementById('record-voice');
                voiceBtn.classList.remove('text-gray-500');
                voiceBtn.classList.add('bg-red-500', 'text-white');
                voiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                
                // æ·»åŠ å½•éŸ³åŠ¨ç”»
                const pulse = document.createElement('span');
                pulse.className = 'absolute inset-0 rounded-full bg-red-400 animate-ping opacity-75';
                voiceBtn.appendChild(pulse);
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('message-input').value = transcript;
                sendTextMessage();
            };
            
            recognition.onerror = function(event) {
                console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
            };
            
            recognition.onend = function() {
                if (isRecording) recognition.start(); // ä¿æŒå½•éŸ³çŠ¶æ€
            };
            
            recognition.start();
        }
        
        function stopRecording() {
            if (recognition) {
                isRecording = false;
                recognition.stop();
                const voiceBtn = document.getElementById('record-voice');
                voiceBtn.classList.remove('bg-red-500', 'text-white');
                voiceBtn.classList.add('text-gray-500');
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                
                // ç§»é™¤å½•éŸ³åŠ¨ç”»
                const pulse = voiceBtn.querySelector('.animate-ping');
                if(pulse) voiceBtn.removeChild(pulse);
            }
        }
        
        // è¯­éŸ³åˆæˆåŠŸèƒ½
        function speak(text) {
            // æ³•å¾‹å£°æ˜ï¼šä½¿ç”¨å…¬å¼€é‡‡è®¿ç‰‡æ®µéœ€è·å¾—æˆæƒ
            const audioFiles = {
                "è°¢è°¢": "kyuhyun_thanks.mp3",
                "çˆ±ä½ ": "kyuhyun_love.mp3",
                // å…¶ä»–å…³é”®è¯æ˜ å°„...
            };
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„éŸ³é¢‘ç‰‡æ®µ
            for (const [keyword, file] of Object.entries(audioFiles)) {
                if (text.includes(keyword)) {
                    const audio = new Audio(`sounds/${file}`);
                    audio.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥:", e));
                    return;
                }
            }
            
            // é»˜è®¤ä½¿ç”¨TTS
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR'; // ä½¿ç”¨éŸ©è¯­è¯­éŸ³åº“
                utterance.rate = 0.9;
                utterance.pitch = 0.95; // æ›´æ¥è¿‘ç”·å£°
                speechSynthesis.speak(utterance);
            }
        }
        
        // åˆå§‹åŒ–æ—¶åŠ è½½è¯­éŸ³åˆ—è¡¨
        speechSynthesis.getVoices();
    </script>
</body>
</html>